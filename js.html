<script>
    const NOTIFICACAO_OK = 1;
    const NOTIFICACAO_DANGER = 2;
    const NOTIFICACAO_WARNING = 3;


    function criarTabelaContatos()
    {
        let tabela = document.getElementById('tabelaContatos');
        if(tabela) tabela.remove();

        google.script.run.withSuccessHandler(criarTabelaContatosCorretamente)
        .withFailureHandler(criarTabelaContatosError)
        .obterContatos();
    }

    function criarTabelaContatosCorretamente(obj)
    {
        let tabela = document.createElement('table');
        tabela.id = 'tabelaContatos';

        let tabelaHeader = document.createElement('thead');
        let tabelaBody = document.createElement('tbody');

        // Header da tabela
        let primeiraFila = document.createElement('tr');
        for(let i =0; i < obj[0].length; i++)
        {
            let celula = document.createElement('th');
            celula.textContent = obj[0][i];
            primeiraFila.appendChild(celula);   
        }
        tabelaHeader.appendChild(primeiraFila);
        tabela.appendChild(tabelaHeader);

        // Body da tabela
        for(let i = 1; i < obj.length; i++)
        {
            let fila = document.createElement('tr');
            for(let j = 0; j < obj[i].length; j++)
            {
                let celula = document.createElement('td');
                celula.textContent = obj[i][j];
                fila.appendChild(celula); 
            }
            tabelaBody.appendChild(fila);
        };

        // Adicioona,ps o cabeçalho da tabela
        tabelaHeader.classList.add('table-dark');
    
        //Adicionamos o corpo da tabela
        tabela.appendChild(tabelaBody);

        //Adicionamos classes do bootstrap a tabela
        tabela.classList.add('table', 'table-striped', 'border', 'border-4', 'table-dark', 'border-dark');

        //adicionamos a tabela na dic do html
        document.getElementById('divContatos').appendChild(tabela);

        // Mostrar notificação de OK
        criarNorificacao(NOTIFICACAO_OK, 'Contatos obtidos corretamente', 'Sucesso');
    }

    function criarTabelaContatosError()
    {
        // Mostrar notificaç~cao de Erro
        criarNorificacao(NOTIFICACAO_DANGER, 'Não pode ser lido os contatos', 'ERRO !!');
    }

    function criarNorificacao(tipo, mensagem, titulo)
    {
        // Obter dados
        let mensagemNotificacao = document.getElementById('mensagemNotificacao');
        let tituloNotificacao = document.getElementById('tituloNotificacao');
        let elementoNotificacao = document.getElementById('notificacao');
        let iconeNotificacao = document.getElementById('iconeNotificacao');
        let notificacao = bootstrap.Toast.getOrCreateInstance(elementoNotificacao);

        // Editar a notificação
        mensagemNotificacao.textContent = mensagem;
        tituloNotificacao.textContent = titulo;

        switch (tipo) {
            case NOTIFICACAO_OK:
                iconeNotificacao.className = '';
                iconeNotificacao.classList.add('bi', 'bi-check-square');
                elementoNotificacao.style.backgroundColor = getComputedStyle(document.documentElement).getPropertyValue('--cor-verde-escuro');
                break;

            case NOTIFICACAO_DANGER:
                iconeNotificacao.className = '';
                iconeNotificacao.classList.add('bi', 'bi-bug');
                elementoNotificacao.style.backgroundColor = getComputedStyle(document.documentElement).getPropertyValue('--cor-vermelho-escuro');
                break;

            case NOTIFICACAO_WARNING:
                iconeNotificacao.className = '';
                iconeNotificacao.classList.add('bi', 'bi-exclamation-square');
                elementoNotificacao.style.backgroundColor = getComputedStyle(document.documentElement).getPropertyValue('--cor-amarelo-escuro');
                break;
        }



                // Mostrar notificacao
        notificacao.show();
    }
</script>