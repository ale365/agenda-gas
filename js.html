<script>
    function inserirContato()
    {
        // Obter dados
        let nome = document.getElementById('nome').value;
        let email = document.getElementById('email').value;

        // Apagando a tabela se ela existir
        removerTabelaContatos();

        // Criar Loader
        criarLoader('divContatos');

        google.script.run
        .withSuccessHandler(contatoInseridoCorretamente)
        .withFailureHandler(contatoInseridoError)
        .inserirContato(nome, email);
    }

    function contatoInseridoCorretamente()
    {
        // Eliminamos os dados de Input
        document.getElementById('nome').value = '';
        document.getElementById('email').value = '';

        // Mostra Notificacao
        criarNotificacaoOk('Contato inserido corretamente', 'CONTATO OK');

        //Eliminamos o loader
        removerLoader();

      // Mostr5amos a tabela de contatos
      criarTabelaContatos();
    }

    function contatoInseridoError()
    {
      criarNorificacaoError('Não podemos inserir o Contato', 'ERRO !!');

      //Eliminamos o loader
      removerLoader();

      // Mostr5amos a tabela de contatos
      criarTabelaContatos();
    }

    function criarTabelaContatos()
    {
        // Apagando a tabela se ela existir
        removerTabelaContatos();

        // Criar Loader
        criarLoader('divContatos');

        google.script.run
        .withSuccessHandler(criarTabelaContatosCorretamente)
        .withFailureHandler(criarTabelaContatosError)
        .obterContatos();
    }

    function criarTabelaContatosCorretamente(obj)
    {
        let tabela = document.createElement('table');
        tabela.id = 'tabelaContatos';

        let tabelaHeader = document.createElement('thead');
        let tabelaBody = document.createElement('tbody');

        // Header da tabela
        let primeiraFila = document.createElement('tr');
        for(let i =0; i < obj[0].length; i++)
        {
            let celula = document.createElement('th');
            celula.textContent = obj[0][i];
            primeiraFila.appendChild(celula);   
        }
        tabelaHeader.appendChild(primeiraFila);
        tabela.appendChild(tabelaHeader);

        // Body da tabela
        for(let i = 1; i < obj.length; i++)
        {
            let fila = document.createElement('tr');
            for(let j = 0; j < obj[i].length; j++)
            {
                let celula = document.createElement('td');
                celula.textContent = obj[i][j];
                fila.appendChild(celula); 
            }
            tabelaBody.appendChild(fila);
        };

        // Adicioona,ps o cabeçalho da tabela
        tabelaHeader.classList.add('table-dark');
    
        //Adicionamos o corpo da tabela
        tabela.appendChild(tabelaBody);

        //Adicionamos classes do bootstrap a tabela
        tabela.classList.add('table', 'table-striped', 'border', 'border-4', 'table-dark', 'border-dark');

        //adicionamos a tabela na dic do html
        document.getElementById('divContatos').appendChild(tabela);

        // Mostrar notificação de OK
        criarNotificacaoOk('Contatos obtidos corretamente', 'Sucesso');

        //Eliminamos o loader
        removerLoader();
    }

    function criarTabelaContatosError()
    {
        // Mostrar notificaç~cao de Erro
        criarNorificacaoError('Não pode ser lido os contatos', 'ERRO !!');

        //Eliminamos o loader
        removerLoader();
    }




    function criarNotificacao(mensagem, titulo)
    {
        document.getElementById('mensagemNotificacao').textContent = mensagem;
        document.getElementById('tituloNotificacao').textContent = titulo;
        let elementoNotificacao = document.getElementById('notificacao');
        bootstrap.Toast.getOrCreateInstance(elementoNotificacao).show();
    }

    function criarNotificacaoOk(mensagem, titulo)
    {
        criarNotificacao(mensagem, titulo);
        criarIconeOk(mensagem, titulo);
        criarCorNotificacao('--cor-verde-escuro');
    }

    function criarNorificacaoError(mensagem, titulo)
    {
        criarNotificacao(mensagem, titulo);
        criarIconeError(mensagem, titulo);
        criarCorNotificacao('--cor-vermelho-escuro');
    }

    function criarNorificacaoAdvertencia(mensagem, titulo)
    {
        criarNotificacao(mensagem, titulo);
        criarIconeAdvertencia(mensagem, titulo);
        criarCorNotificacao('--cor-amarelo-escuro');
    }

    function criarIconeOk(mensagem, titulo)
    {
        document.getElementById('iconeNotificacao').className = '';
        document.getElementById('iconeNotificacao').classList.add('bi', 'bi-check-square');
    }

    function criarIconeError(mensagem, titulo)
    {
        document.getElementById('iconeNotificacao').className = '';
        document.getElementById('iconeNotificacao').classList.add('bi', 'bi-bug');
    }

    function criarIconeAdvertencia(mensagem, titulo)
    {
        document.getElementById('iconeNotificacao').className = '';
        document.getElementById('iconeNotificacao').classList.add('bi', 'bi-exclamation-square');
    }

    function criarCorNotificacao(cor)
    {
        let elementoNotificacao = document.getElementById('notificacao');
        elementoNotificacao.style.backgroundColor = getComputedStyle(document.documentElement).getPropertyValue(cor);
    }


    function criarLoader(elementoPai)
    {
        removerLoader();
        let loader = document.createElement('div');
        loader.id = 'loader';
        loader.appendChild(document.createElement('div'));
        loader.appendChild(document.createElement('div'));
        loader.appendChild(document.createElement('div'));
        loader.appendChild(document.createElement('div'));
        return document.getElementById(elementoPai).appendChild(loader);
    }

    function criarLoaderBolinhas(elementoPai)
    {
        let loader = criarLoader(elementoPai);
        loader.classList.add('lds-roller');
    }

    function criarLoaderBarrinhaCirculo(elementoPai)
    {
        let loader = criarLoader(elementoPai);
        loader.classList.add('lds-ring');
    }

    function removerLoader()
    {
        let loader = document.getElementById('loader');
        if(loader) loader.remove();
    }

    function removerTabelaContatos()
    {
        let tabela = document.getElementById('tabelaContatos');
        if(tabela) tabela.remove();
    }
</script>